<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Make it Universal</title>
    <link href="bootstrap/dist/css/bootstrap.css" rel="stylesheet">
  <link href="p7.css" rel="stylesheet"><link href="app.css" rel="stylesheet"></head>
  <body>
    <!--<div id="sidebar" class="sidebar">
  <div class="sidebar-label">Qlik Extension Tutorial</div>
  <div><a href="javascript:void(0)" class="closebtn">&times;</a></div>
  </br>
  </br>
  <hr/>
  <ul class="nav nav-sidebar">
    <li class="chapter-0"><a href="100. Prereq Qliks Open Ecosystem.html"><span class="glyphicon glyphicon-menu-right"></span> 100. Qlik's open ecosystem</a>
      <ul class="nav sub-sidebar sublist-0">
        <li><a href="#h2-0">Meet the Qlik Sense client</a></li>
        <li><a href="#h2-1">Qlik Sense under the hood</a></li>
        <li><a href="#h2-2">The open ecosystem</a></li>
        <li><a href="#h2-3">Why an open ecosystem?</a></li>
        <li><a href="#h2-4">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-1"><a href="101. What Are Extensions.html"><span class="glyphicon glyphicon-menu-right"></span> 101. What are extensions</a>
      <ul class="nav sub-sidebar sublist-1">
        <li><a href="#h2-0">What are extensions conceptually?</a></li>
        <li><a href="#h2-1">What are extensions technically?</a></li>
        <li><a href="#h2-2">How do you deploy an extension?</a></li>
        <li><a href="#h2-3">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-2"><a href="102. Hello World.html"><span class="glyphicon glyphicon-menu-right"></span> 102. Hello World</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">Prerequisites</a></li>
        <li><a href="#h2-1">Anatomy of an extension</a></li>
        <li><a href="#h2-2">Setting up development environment</a></li>
        <li><a href="#h2-3">Wiring it together with code</a></li>
        <li><a href="#h2-4">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-3"><a href="103. Make it Data Driven.html"><span class="glyphicon glyphicon-menu-right"></span> 103. Make it data driven</a>
      <ul class="nav sub-sidebar sublist-3">
        <li><a href="#h2-0">Lifecycle of an Extension</a></li>
        <li><a href="#h2-1">Defining Our Data</a></li>
        <li><a href="#h2-2">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-4"><a href="104. Make it Selectable.html"><span class="glyphicon glyphicon-menu-right"></span> 104. Make it selectable</a>
      <ul class="nav sub-sidebar sublist-4">
        <li><a href="#h2-0">The backend API</a></li>
        <li><a href="#h2-1">Adding selections to our table</a></li>
        <li><a href="#h2-2">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-5"><a href="105. Make it Stylish.html"><span class="glyphicon glyphicon-menu-right"></span> 105. Make it stylish</a>
      <ul class="nav sub-sidebar sublist-5">
        <li><a href="#h2-0">Creating a stylesheet</a></li>
        <li><a href="#h2-1">Module loading</a></li>
        <li><a href="#h2-2">Keep it modular</a></li>
        <li><a href="#h2-3">Adding custom property panel items</a></li>
        <li><a href="#h2-4">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-6"><a href="106. Make it Responsive.html"><span class="glyphicon glyphicon-menu-right"></span> 106. Make it responsive</a>
      <ul class="nav sub-sidebar sublist-6">
        <li><a href="#h2-0">Adding responsiveness via CSS</a></li>
        <li><a href="#h2-1">Adding responsiveness via JS</a></li>
        <li><a href="#h2-2">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-7"><a href="107. Make it Universal.html"><span class="glyphicon glyphicon-menu-right"></span> 107. Make it universal</a>
      <ul class="nav sub-sidebar sublist-7">
        <li><a href="#h2-0">Environment Context</a></li>
        <li><a href="#h2-1">Printing Extensions</a></li>
        <li><a href="#h2-2">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-8"><a href="108. Make it Scalable.html"><span class="glyphicon glyphicon-menu-right"></span> 108. Make it scalable</a>
      <ul class="nav sub-sidebar sublist-8">
        <li><a href="#h2-0">Paging the Data</a></li>
        <li><a href="#h2-1">Pulling All Pages in Parallel and in Sequence</a></li>
        <li><a href="#h2-2">Fin</a></li>
      </ul>
    </li>
  </ul>
</div>-->

    <div class="hamburger-open">&#9776;</div>

    <div class="main-content">
      <div class="container content">
        <div class="header">
          <h1>107. Make it Universal</h1><p>Learning goal: Identify key considerations when building extensions that need to be deployed across environments, such as relative and absolute resource paths and exporting capabilities</br><a href="https://github.com/axisgroup/my-table/tree/107-make-it-universal" target="_blank">Chapter 107 complete code</a></p>
          <hr/>
        </div>
        <div id="body-content">
          <div id="section-0"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <p>We’ve built a simple table that can take in dynamic Qlik data, respond to user entered properties, and format itself based on size. However, we’ve only tested our extension on Qlik Sense Desktop. Will our extension work the same when we upload it to a server? Will it work for any server we upload it to? What about printing? Let’s discuss some considerations when building extensions that need to work across environments.</p></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div><div id="section-1"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <h2>Environment Context</h2><p>The Extension APIs are consistent across environments, so there is no need to worry about calls working on Desktop vs. Server. However, there is a third environment where your extension might run: via the print service.</p></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div><div id="section-2"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <h3>The Print Service</h3><p>When exporting an image of an extension, Qlik runs your extension code via the print service. The print service used a cached set of data and is not connected to the QIX Engine in real time. This limits some of the functions that can be performed, such as using the <a href="http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/APIs/Content/mashup-api-reference.htm" target="_blank">Capabilities API</a> to interact with the QIX Engine. Using the Capabilities API within an extension is not covered in this course, but if you are using it, you could run into issues if you attempt to call it in the print service.</br></br></p><p>In order to isolate code that shouldn’t run in the print service, you can add a check for the print service via the <a href="http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/APIs/Content/backend-api-reference.htm" target="_blank">Backend API</a>. If the Backend API has a property called “isSnapshot” that is true, then the current context of the extension is the print service. You can create a variable to capture this like: </br><code>var inPrint = this.backendAPI.isSnapshot === true</code></br></br></p><h3>Absolute vs. Relative Paths</h3><p>Sometimes in extensions, we may use external files. For example, if creating a chart with icons, we will need to reference image files for the icons. In those situations, it is crucial that we don’t rely on absolute paths. Why? Imagine you are creating an extension and testing it out on a test server called <code>testserver</code>. You could load the image like so: <code>http://testserver/extensions/myExtension/images</code> . However, if you try to move this extension to a production server, it will no longer work as the address above references the test server instead of the production server. Be sure when using paths to load files that they are either relative paths or dynamically generated based on their location. Another alternative is to host additional resources on a third-party server that can be accessed by any of your target environments.</p></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div><div id="section-3"class="section support-editor"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <h2>Printing Extensions</h2><p>As mentioned above, the print service enables us to export images of our extension. This is a useful feature when we want to enable our users to leverage our visualizations in other platforms, such as a static presentation. Let’s enable this feature by opening <em>support.js</em> and adding the <code>export</code> property:</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="support-editor"></div></div></div></div><div id="section-4"class="section export-pdf"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <p>Now we can export our extension to an image or PDF with a right-click.</br></br></p><h3>Limitations</h3><p>Note that there are 2 key support limitations of printing extensions, <a href="http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/APIs/Content/ExtensionAPI/export-property.htm" target="_blank">per the documentation</a>:</p><ul><li><p>Qlik Sense does not support exporting or printing of visualization extensions that use external resources.</p></li><li><p>Qlik Sense does not support exporting or printing of visualization extensions that uses internal and undocumented JavaScript modules or APIs.</br></br></p></li></ul><p>While these functions are not supported by Qlik Sense, they are technically feasible but must be managed by the developer, with no reliance on the Extension API for them. For example, you can load an external resource if the print service is able to access it, which usually requires using a third-party hosting solution with unrestricted access.</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="export-pdf"><img src="./images/export-pdf.png" alt="" class="img-responsive"></img></div></div></div></div><div id="section-5"class="section paint-editor"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <h3>What about async?</h3><p>When printing our extension, the print services waits for a certain period of time for the extension to finish rendering, then takes a snapshot of it. However, what if we have an extension that takes longer to complete? What if our extension relies on some asynchronous events that need to finish before rendering can happen?</br></br></p><p>The answer to these problems is to provide a signal back to Qlik Sense about when our extension is ready for printing. This can be done via the <code>paint</code> function. Our example extension doesn't have this problem, so we don't need to make any changes. Let's look at the solution to this problem conceptually however. First consider what we have done with the <code>paint</code> function in our extension. It basically follows the format:</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="paint-editor"></div></div></div></div><div id="section-6"class="section paint-editor-2"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <p>Our <code>paint</code> function manipulates the web page to draw our chart, but it never returns anything to it’s caller. However, Qlik Sense allows you to return a <code>Promise</code> from the <code>paint</code> function if you want to signal when the extension is ready for printing. <a href="https://developers.google.com/web/fundamentals/getting-started/primers/promises" target="_blank">A Promise is an object in JavaScript that allows you to return a value asynchronously.</a> If Qlik Sense gets a Promise back from your <code>paint</code> function, it assumes that when this <code>Promise</code> is fulfilled, the extension is done rendering and it should print. This functionality will give you a higher degree of control over this process, if you need it for complicated situations like asynchronous processes in your extension. An example of a barebones paint function with this method in place may look like so:</br></br></p><p>In this example, we used <code>fetch</code> to do an asynchronous call to an external resource. We created a Promise around that code so that the print service will know when the request is done and the chart can be printed.</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="paint-editor-2"></div></div></div></div><div id="section-7"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <h2>Fin</h2><h4>Recap</h4><ul><li><p>Extensions can be deployed across multiple environments, so be careful of writing any code that is environment specific</p></li><li><p>The print service has some limitations</p></li><li><p>An extension’s paint function can return a Promise that will signal when an extension is done rendering and is ready for printing</p></li></ul><h4>Resources</h4><ul><li><p><a href="http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/APIs/Content/ExtensionAPI/export-property.htm" target="_blank">Extension Export Documentation</a></p></li><li><p><a href="https://developers.google.com/web/fundamentals/getting-started/primers/promises" target="_blank">Promises in JS</a></p></li></ul></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div>
        </div>
        <hr/>
      </div>
    </div>

    <script src="jquery.min.js"></script>
    <script src="bootstrap/dist/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="p7.bundle.js"></script><script type="text/javascript" src="app.bundle.js"></script></body>
</html>