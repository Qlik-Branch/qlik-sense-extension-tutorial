# 102. Hello, World
Learning goal: Deep dive on how extensions work under the hood and create our first extension

<div id="my-table-design" class="graph">![](./imgs/my-table-design.png)</div>

**Lets get started** 

The remainder of this guide will walk us step by step through creating an extension object. In the process, we’ll learn about the underlying code of extensions and how the APIs work, giving us the foundation to explore more advanced use-cases on our own. To keep things relatively simple, let’s build a simple table extension, demonstrated here. 

This object will be both responsive and respond to selections, fitting seamlessly with the Qlik Sense Client.

<div id="resource-list-design" class="graph"></div>

## Prerequisites for this Guide
Throughout this walkthrough, we’ll leverage browser-based web development as described in the previous chapter. This guide will suppose that we have some knowledge of the following components and will not attempt to teach them:
* HTML5
* JavaScript, specifically:
	* functions
	* for loops and if statements
	* Objects
	* DOM manipulation
	* Promises
* JSON
* CSS

For further reading on the above subjects, check out the following:

<div class="graph"></div>

## Setting up our development environment
Before we start creating an extension, lets set up our code environment. For this walkthrough, we’ll leverage Qlik Sense Desktop for testing our extension and a text editor for writing the code.

<div id="my-table-folder" class="graph">![](./imgs/my-table-folder.png)</div>

As you may recall, in Qlik Sense Desktop an extension resides in a folder under _Users\{your-username}\Documents\Qlik\Sense\Extensions_. Let’s create this folder.
1. Navigate to _Users\{your-username}\Documents\Qlik\Sense\Extensions_  on your computer
2. Create a new folder for the extension. 
3. Name it “my-table”. 

This folder will contain all of our extension code that we write. 

<div class="graph"></div>

In order to write code, we at a minimum need some sort of text editor to edit the text of our code files. While any text editor will do, more advanced code editors can come in handy as they provide special features like autocorrect, syntax checking, tabbed files, etc. For HTML_JS_CSS, we recommend [Visual Studio Code](https://code.visualstudio.com/) or [Sublime Text](https://www.sublimetext.com/).

Once we have Qlik Sense Desktop, a new extension folder, and a text editor, we can get started.

<div class="graph"></div>

## Anatomy of an extension
Let’s start off by examining the components of Qlik Sense charts that we will leverage. First, lets focus on the visual parts.

<div id="container-and-properties" class="graph">![](./imgs/container-and-properties.png)</div>

### The Frontend: UI Components
A chart really only has two UI components that we need to work with: a container element and a properties panel. 

* Container Element
	* When we drag a chart onto a dashboard, an HTML element is created that fills the grid space that the chart should occupy. That element becomes the container for our chart. In our extension, we are going to populate this container with a table
* Properties Panel
	* The properties panel is the component used by Qlik users to configure charts when using Sense in Edit mode. For example, a user may use a dropdown to pick which dimensions and measure are used, or change the axes styling of a chart. When creating extensions, we can define properties panels that behave identically to the out of the box charts, leveraging existing panel components to easily build out our own panel.

These two components are how our users will interact with our table extension. They’ll use the properties panel to configure the table and the container element to see it. But behind the scenes, we need data to control what options can be configured. In order to do that, let’s look at the data components.

<div class="graph"></div>

### The Backend: The Generic Object
In order to draw our table, we need 2 sets of information:
1. Metadata that defines attributes of our table, like the font size
2. Data that will be used to populate the table cells

This information needs to be saved somewhere so that when a user reloads the page, they still have the same table they configured before. Enter the **Generic Object**.

The Generic Object is an intimidating creature at first, but it really has more bark than bite. A Generic Object is a structure for storing and interacting with data in a Qlik QVF file.  All charts in Qlik Sense sit on top of a Generic Object. An object provides a chart with the necessary information for it to figure out what to draw. 

Let’s dive deeper on this necessary information. There are two data components associated with a Generic Object: properties and layouts.

<div id="generic-object-properties" class="graph">![](./imgs/generic-object-properties.png)</div>

#### Properties
The properties of a Generic Object are akin to a definition. They define static and dynamic values for the object. They are written as JSON and saved as part of the QVF file. They always have a `qInfo/qType` property that Qlik uses to organize them.  Let’s ignore the `qType` property for now and focus on the static and dynamic properties.
</br>
</br>
</br>
</br>
So what is the difference between a static property and a dynamic property? Well, keep in mind that we are working with Qlik’s Associative Model. The power of this model is the ability to calculate dynamic data on the fly. A dynamic property is any property that leverages the Qlik Engine to calculate a value. In the example above, our static properties do not need the Qlik Engine in order to produce a value. They already are values! 

<div id="static-dyn-prop-diagram" class="graph">![](./imgs/qix-engine.png)</div>

For example, staticProp1 is equal to the number 42. Nothing to calculate there. On the other hand, our dynamic properties are not values. They are formulas for calculating values. If we look at dynamicProp2, we cannot derive the value of that formula. We need the Qlik Engine to do that for us.

<div class="graph"></div>

Qlik has various dynamic property types that can be defined. We will touch on a couple of them later in this guide, but if you want to learn more in the meantime, check out the [API reference for Generic Object properties.](http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/EngineAPI/Content/GenericObject/PropertyLevel/properties-that-can-be-set.htm)

This brings us to the other side of the Generic Object coin – layouts.

#### Layouts
A layout is the result of running a Generic Object properties definition through the Qlik Engine. In this process, all static properties are carried over and all dynamic properties are calculated. Unlike properties, layouts are not saved anywhere. They are calculated on the fly so that we have the freshest data for drawing our extension.

<div id="static-dyn-prop-interactive" class="graph">![](./imgs/static-dyn-prop-interactive.png)</div>

In short, properties provide a definition for the data in our Generic Object. Layouts provide the results of evaluating those definitions with our Qlik data. Try playing with this relationship in the diagram below!

<div id="properties-layout-visual" class="graph">![](./imgs/properties-layout-visual.png)</div>

Now that we’ve investigated the front and back end pieces of an extension, let’s take a step back and examine the full picture. The properties panel is used by a user to configure the properties of a Generic Object. These properties are translated by the Engine into a layout with all static and dynamic values calculated. This layout is then used to create a visual that is displayed in the container element.

<div id="extension-architecture-diagram" class="graph">![](./imgs/extension-architecture-diagram.png)</div>

### Summarizing the Architecture
As we’ve seen, our front-end includes a container element for rendering a chart and a properties panel for configuring the chart. On the back-end, we use a GenericObject to hold our chart properties and retrieve calculated data from the QIX engine via layouts. This architecture is summarized like so:

<div class="graph"></div>

## Wiring It Together with Code
We’ve got a sense of how these pieces work together, so let’s look at the actual code required to interface with them and wire up an example.

In our **my-table** extension directory that we created previously, we need a minimum of two files for the extension to run properly:

##### 1. my-table.qext
This file contains metadata about our extension, including properties like name and description that will appear in Qlik Sense, author name, etc. It describes our extension and gives Qlik Sense the necessary information it needs to put the extension into the Qlik Sense Client. The **.qext** file format is specific to Qlik Sense Extensions, but in actuality it just expects a JSON format. The name of the file must match the name of your extension directory.

Our **.qext** object can have any property we want on it, but there are specific properties that Qlik Sense will use when installing your extension, some of which are mandatory. They are:

* name – (mandatory) the name of the extension. This name will appear in the chart library in Qlik Sense
* type – (mandatory) the type of the extension. For chart objects, this value should always be “visualization”
* description – This text should describe our extension for our users. It will appear in the preview of the extension
* icon – The name of the icon used in the chart library panel. The default is “extension”  ![](./imgs/extension-icon.png). [There are several other options built in](http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/Extensions/Content/Overview/qext-file-overview.htm), or you can include a custom icon with your extension.
* preview – A preview image that is displayed when a user first puts your chart on the page without the necessary data. By default, it will use the icon defined previously.
* version – A version indicator of our choice. [Semantic versioning is a great place to start.](http://semver.org/) 
* author – The name of the extension creator

<div id="qext-editor" class="graph"></div>

Let’s fill out our first **.qext** file with the basics! Create a new file in your directory called **my-table.qext**. Create the following JSON structure manually, or use this page to directly edit and then copy and paste!

We’ve defined the metadata of our extension so that Qlik Sense can install and use our extension properly. Next up: defining the behavior of the extension.

<div class="graph"></div>

##### 2. my-table.js
The only other required file for an extension is a JavaScript file that defines our extension. The file must have the same name as our extension folder and create a module that returns a JSON object. This object will have properties covering various attributes and behaviors of our extension. 

As mentioned, our JavaScript file needs to create a module. What does that mean exactly? Well, a module is just a group of code. Typically, a module has a distinct purpose and is self-contained. Modules allow us to break our code into smaller components that can be re-used and easily managed. For more on modules, check out [this guide](https://medium.freecodecamp.com/javascript-modules-a-beginner-s-guide-783f7d7a5fcc). JavaScript in the browser does not support modules natively. Qlik Sense uses a library called `RequireJS` to handle module support. We will not go into the details of [RequireJS](http://requirejs.org/) here, but we will skim through the basics as we need it. In RequireJS, we create modules using a function called `define`.  The `define` function takes two inputs: a list of other modules that should be loaded first in case we need to use them in our module (also known as _dependencies_), and then a function that represents our module. Dependencies are entered as an array; we will go deeper on that topic later. Let’s go ahead and define our extension.

<div id="js-editor" class="graph"></div>

Create a new file in your directory called **my-table.js**. In that file, let’s define our module with no dependencies and have it return an empty JSON object:

And there we have it, our first Qlik Sense extension! ;). The module above will run whenever we create an extension object on a dashboard. This includes when we open or reload a sheet with the object already on it. This module **initializes** the extension object.

<div class="graph"></div>

Of course, it doesn’t do anything right now because our module above returns a completely empty object for our extension. There are various properties we can add to setup our extension:

* initialProperties – JSON of the default properties to start with on our Generic Object
* definition – JSON describing the properties panel that users will interact with
* paint – a function that will run every time our extension gets new data
* resize – a function that will run every time our extension is resized
* support – JSON describing additional Qlik Sense features that our extension should allow, such as exporting data

Let’s go through the properties 1 by 1 and add them to our extension.

<div id="initial-properties-editor" class="graph"></div>

##### Initial Properties
As mentioned before, our extension runs on a Generic Object which has a collection of static and dynamic properties that can be evaluated by the Engine. While these properties are usually configured by users through the properties panel, we can initialize our extension with certain preset values by passing in a JSON object to the initial properties panel. Let’s define a static property on our extension to get started. We’ll call it `textColor` and set the initial value to _“black”_. We’ll define the properties in a variable and then pass them in to our returned object to keep the code clean as we scale up.

<div class="graph"></div>

##### Definition
Our users need to configure our extensions with the chart properties panel. This configuration may involve adding data or changing a visual attribute like text color. Enter the `definition` JSON. Qlik Sense provides a number of components for the properties panel that we can define in this definition file and link to properties of our Generic Object. These components include items like accordion menus, dropdown menus, and text inputs. We will explore this menu in depth later. For more details, check out the [custom properties reference](http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/Extensions/Content/Howtos/working-with-custom-properties.htm).

<div id="definition-editor" class="graph"></div>

Let’s start simple by including the standard settings that come with most Qlik Sense charts. These are the settings that control the title bar <more here>. Qlik Sense allows us to re-use this menu easily via the “uses” property. We will put them into an “accordion” component that will create a collapsible set of menus in our panel:

<div id="def-initprops-editor" class="graph"></div>

Putting it all together, we get:

<div class="graph"></div>

##### Paint
We’ve got a Generic Object and a properties panel – now we can render something to the screen. This is where the `paint` function comes in.  The `paint` function has two inputs: our container element and our Generic Object layout. Now we have everything we need to visualize dynamic content onto our dashboard.

The `paint` function is a callback function that Qlik Sense will run every time there is new data for the extension so that we are always visualizing up to date data. This data updating event is typically the result of a user filtering the Qlik Sense app. If there is no `resize` function defined, `paint` will also run when the chart resizes thanks to the responsive model of Qlik Sense. 

<div id="paint-editor" class="graph"></div>

Let’s print a simple “hello, world” message to our screen. Recall that we created a static property on our Generic Object for textColor. We will grab that property value from the layout and use it to style our text.

Our container element is provided to us as an [Angular jqLite wrapped DOM node](https://docs.angularjs.org/api/ng/function/angular.element).

<div id="js-editor-2" class="graph"></div>

Once again, we can put it all together in our returned JSON like so:

<div class="graph"></div>

##### Resize
The resize function works exactly like the paint function; it is just called at a different time. If we don’t define a resize function, Qlik Sense will use our paint function when the chart resizes. For our extension, we will not leverage a separate resize function.

**When should you use a resize function?**
Resize functions can help optimize the performance of an extension if it doesn’t need to completely re-render from scratch when the dimensions of the chart change. So, if you can handle your resize event with less operations than rendering the entire data set again, it can be handy to implement a resize function.

<div id="support-editor" class="graph"></div>

##### Support
The support property allows us to enable certain OOB features that come with Qlik Sense charts, such as exporting data or allowing snapshots into stories.

Let’s enable [data export](http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/APIs/Content/ExtensionAPI/exportdata-property.htm) and [allow snapshotting](http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/APIs/Content/ExtensionAPI/snapshot-property.htm):

<div id="js-editor-3" class="graph"></div>

Our final extension code should look like so:

<div class="graph"></div>

### Testing Our Extension
Now that we’ve written the necessary code for our extension to render, we can test it out in Qlik Sense. There are two ways to do this on Qlik Sense Desktop: through the app or in the browser. We suggest testing extensions through the browser for 2 reasons:
1. Browsers come with developer tools that make it easier to debug our code
2. Qlik Sense Desktop by default caches our extension code. This can lead to confusion as we may make a change to our extension files that Qlik Sense Desktop does not pick up because it had cached an earlier version. In a browser, we can turn cacheing off in order to avoid this problem.

We recommend using Google Chrome due to the robustness of it’s developer tools. In order to open Qlik Sense Desktop in Chrome, lets follow these steps:

<div id="qlik-sense-desktop" class="graph">![](./imgs/qlik-sense-desktop.png)</div>

##### 1.Open Qlik Sense Desktop
In order to use Qlik Sense in the browser, we first must open Qlik Sense Desktop. As long as Qlik Sense Desktop is open, Qlik Sense will be running on our machine.

<div id="qsd-in-browser" class="graph">![](./imgs/qsd-in-browser.png)</div>

##### 2. Open Chrome and go to `http://localhost:4848`
When Qlik Sense Desktop is open on our browser, Qlik Sense will run on a local web server on port 4848. We can hit this port from any browser to use Qlik Sense. Then, open an app where you can test your extension.

<div id="dev-tools" class="graph">![](./imgs/dev-tools.png)</div>

##### 3. Open DevTools
In Chrome, the DevTools panel contains a lot useful resources for debugging extensions. It also will enable us to disable cacheing. To open the tools, click on the dropdown menu in the top right and select _More tools > Developer tools_.

<div id="disable-cache" class="graph">![](./imgs/disable-cache.png)</div>

##### 4. Disable Cacheing
On the DevTools, click on the Network tab and check the `Disable Cache` option. Now, whenever the DevTools is open, the browser will not cache any code, allowing us to see the latest updates to our extension. 

<div id="extension" class="graph">![](./imgs/extension.png)</div>

##### 5. Play with our extension!
Once we’re set up with no cacheing, we can add our extension to the page and check it out! Navigate to the Extensions panel and find `my-table` from the list. Drag it to the dashboard and voila, our first extension! Notice how in the properties panel of the extension, we have options for `Appearance`. Those came from the settings we re-used in our properties panel definition file.

## Fin
#### Recap
* Extensions use an element container and a properties panel on the front-end to allow users to see and configure their chart
* Extensions use a Generic Object on the backend to store metadata and calculate dynamic data from the QIX Engine
* Extensions are defined with a JavaScript file that returns an object with various properties that define the functionality of the extension
* Qlik Sense Desktop can be used via a web browser, which can be useful for debugging

#### Resources
* [Generic Object Properties API Reference](http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/EngineAPI/Content/GenericObject/PropertyLevel/properties-that-can-be-set.htm)
* [Extension API Reference](http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/APIs/Content/extensions-api-reference.htm)
* [Chrome DevTools Overview - Google Chrome](https://developer.chrome.com/devtools)

#### Troubleshooting Guide
* 
