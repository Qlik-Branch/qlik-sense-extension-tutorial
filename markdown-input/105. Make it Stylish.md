# 105. Make it Stylish
Learning goal: Use modules to create more maintainable code and a stylesheet to improve the visuals
</br>
[Chapter 105 complete code](https://github.com/axisgroup/my-table/tree/105-make-it-stylish)

<div id="ext-table" class="graph">![](./imgs/ext-table.png)</div>

Our table is visible and interactive on our dashboard, but it doesn’t exactly look right. In particular, the table header cells seem off. They are inheriting a style that aligns them in the middle of the column, even though our table body contents are aligned left. 
</br>
</br>

Let’s fix that by applying our own CSS! 

<div id="files-with-stylesheet" class="graph">![](./imgs/files-with-stylesheet.png)</div>

### Creating a Stylesheet
To write our CSS, let’s create a completely new file in our extension directory. Label it _style.css_.
</br>
</br>

When we open the file, we can start to add CSS that will style our extension. This CSS will be added to the web page when our extension loads. Therefore, we need to be careful here. Our CSS could affect other elements on the page outside of our extension, which we don't want to do. In order to make sure our CSS only applies to our extension, we’ll take advantage of CSS’ _descendant selectors_. [Descendant selectors allow us to specify styles for elements that have a specific ancestor.](https://developer.mozilla.org/en-US/docs/Web/CSS/Descendant_selectors) This appears in the format </br><code>ancestorSelector descendantSelector { /* css property definitions in here */ }</code>.

<div id="css-editor" class="graph"></div>

In our case, we want to target all <code>&ltth&gt</code> elements that are descendants of our extension container. What should our ancestor selector be for our extension container? In Qlik Sense extensions, all extensions have an ancestor class corresponding with their extension type. This class is written in the format “.qv-object-<EXTENSION NAME>”. In our case, this class would be “.qv-object-my-table”. 
</br>
</br>

We can use this class as an ancestor when we define our CSS. Let's add CSS to our stylesheet that will style the header and data cells, as well as stripe the rows. We'll also add a rule for cells with the class <code>.measureCell</code>. This rule will right align those cells.
</br>
</br>

We have our stylesheet, but it isn’t doing anything yet. Remember that our extension only loads in our <code>.qext</code> file and our <code>my-table.js</code> file. We need to tell Qlik to load this stylesheet so we can use it as well. How to do that? With RequireJS’ module loading.

<div id="require-js-editor" class="graph"></div>

### Module Loading
In Chapter 102, we saw that [RequireJS](http://requirejs.org/) is used to load modules into our extension. But as of now, we aren’t using this feature at all. Currently, our extension module is defined with an empty array of dependencies like so:

<div id="require-js-editor-2" class="graph"></div>

RequireJS can load in named modules as well as other JavaScript files via relative paths. For example, Qlik Sense ships with jQuery and it is defined as a named module. If we want to use it, we can load it in like so:

<div id="require-js-editor-3" class="graph"></div>

However, it can also handle other file types with plugins. Once such plugin is the <code>text</code> plugin that allows us to load any file type as text. This plugin comes with Qlik Sense and can be used to load our stylesheet using a relative path. To use the plugin, just put <code>text!</code> in front of the relative path for our CSS:

<div id="require-js-editor-4" class="graph"></div>

Great! We learned how to use the text plugin AND we loaded a new file that we created. But this text plugin just gave us the contents of our stylesheet file as a string. Now we need to actually add it to the page. Let’s create a new style element, add our cssText to its contents, and put it on the page:

<div id="aligned-headers" class="graph">![](./imgs/aligned-headers.png)</div>

Our new stylesheet is now being loaded in and added to our page when our extension is created. We now have a neatly styled table, with zebra stripes in groups of 3. However, our measure cells are not right aligned, because we have not tagged them with the <code>.measureCell</code> class that we defined in our stylesheet.

<div id="paint-measure-cell-editor" class="graph"></div>

Let's modify our _paint.js_ file to tag any header and data cells that are measures with the <code>.measureCell</code> class. In our for loop where we create the measure labels, we simply add the style. In our for loop that creates the data cells, we can leverage our if statement that checks for dimensions and add an else clause to it for measures. In the else clause, we can set the style.


<div class="graph"></div>

### Keep it Modular
In the process of learning about using a stylesheet, we learned how to load in external files for our extension. We can use this concept to modularize our code, allowing us to separate components into different files to make the code easier to maintain over time. Let’s examine how we can modularize our JavaScript and clean up our extension code.
</br>
</br>

In our _my-table.js_ file, we have lots of long JavaScript defining different parts of our extension, such as our <code>paint</code> function and our <code>initialProperties</code> JSON. We can move all of these code pieces into their own files so it is easier for us to manage. Let’s try it out with our <code>initialProperties</code> JSON:

<div id="keep-it-modular" class="graph">![](./imgs/initial-properties.png)</div>

1. Create a new file in the _my-table_ directory called _initialProperties.js_ 

2. Define a module with no dependencies like so:

3. Return an object representing our initialProperties, copied from our _my-table.js_ file

4. Load the newly created module into the _my-table.js_ file and map it to a variable in the module function

5. Remove the old declaration of myProps from the _my-table.js_ file, since the value is now fed from the dependency injection at the top

<div class="graph"></div>

Now we have our initialProperties stored in an external file! From now on, we can edit that file whenever we want to change the initial properties. Go ahead and repeat the steps above for the other variables like so:
* place the <code>myDefinition</code> variable into a file called <code>definition.js</code>
* place the <code>myPaint</code> variable into a file called <code>paint.js</code>
* place the <code>support</code> variable into a file called <code>support.js</code>

<div id="javascript-editor-2" class="graph"></div>

Our final code in _my-table.js_ should now look clean like this:

<div class="graph"></div>

<div id="custom-property-architecture" class="graph">![](./imgs/custom-prop.png)</div>

### Adding Custom Property Panel Items
[Our extension’s property panel gives users the ability to configure our extension to their needs.](http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/Extensions/Content/Overview/visualization-properties.htm) With this functionality, we can deliver dynamic extensions that provide a more flexible and feature-rich experience for our users. So far, we’ve leveraged Qlik Sense’ pre-defined components to quickly add dimension and measure configuration to our properties panel. However, Qlik Sense also supports custom property definitions that we can use to expand what our extension can do. The graph to the right shows how custom properties are leveraged by the extension. Let’s explore.
</br>
</br>

**Properties Panel Definition Structure**
As we’ve seen so far, our properties panel definition is stored as a JSON object. Each property of that object can use what are called “property templates” to render a property in the panel in different ways. Typically, these properties connect back to the Generic Object properties so that we can use the panel to change our Generic Object.
</br>
</br>

Qlik Sense has many different types of property templates that we can use. [For example, there are types for string inputs, numeric inputs, check boxes, drop downs, and sliders.](http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/Extensions/Content/Howtos/working-with-custom-properties.htm)We can even create groups of types using a special type called “items”. Groups of types are useful for organizing our properties panel into a hierarchy that users can easily navigate.

<div id="properties-editor" class="graph"></div>

Let’s put these concepts into action by adding a property for the text color in our table. We will use a string property so that users can enter their own color code into the extension.
</br>
</br>

Let’s start by accessing the <code>items</code> that are a part of the “settings” component we are already using for the Appearance section of our panel. Make the following change to the <code>settings</code> property in _definition.js_:

<div id="properties-editor-2" class="graph"></div>

As mentioned previously, groups of properties are organized using <code>items</code> in the properties panel. Our settings contains groups of items, so we can add on to that. Let’s add an additional property for our text color:

<div id="properties-editor-3" class="graph"></div>

Now we have a property for text color, but we haven’t given it a definition. Using the custom properties documentation online <link>, we can define any number of types of inputs. For this use case, we will use the custom string property. Following the documentation, we can define like so:

<div id="properties-editor-4" class="graph"></div>

A key part of the code above is the <code>ref</code> property. The <code>ref</code> property provides a reference to where the property should exist on our Generic Object. This will allow us to access it from the layout object that is passed to our paint function. Here, we set the property reference to textColor, which is a property on our Generic Object. Now we can modify our paint code to use this color. We can add a style to the <code>table</code> to use the text color:
</br>
</br>

With this panel definition in place, we can now change that value on the fly from the extension’s properties panel.
</br>
</br>

Go ahead and try it out! Enter any valid HTML color string, like “red”, “#4286f4”,  or “rgb(244, 65, 241)” to see the table colors update.

<div class="graph"></div>

## Fin
#### Recap
* Stylesheets can be used to adjust the look and feel of our extensions
* We can break our code out into different files defined as “modules” to make the code easier to maintain.
* We can add our own custom properties to the extension properties panel to enable users to configure specific attributes of our extension.

#### Resources
* [RequireJS for module loading](http://requirejs.org/)
* [Properties Panel Documentation](http://help.qlik.com/en-US/sense-developer/3.2/Subsystems/Extensions/Content/Overview/visualization-properties.htm)
